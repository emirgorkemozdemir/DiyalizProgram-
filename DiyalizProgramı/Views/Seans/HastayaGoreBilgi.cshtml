@using EntityLayer
@model List<Seans>

@{
    Layout = null;
}

<head>
    <link rel="stylesheet" href="/lib/bootstrap/dist/css/bootstrap.css" />
</head>

<div class="container mt-4">

    <!-- Başlık ve Hızlı Aksiyonlar -->
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h2>Seans Listesi</h2>
        <a href="/Seans/Ekle?id=" class="btn btn-primary">Yeni Seans Ekle</a>
    </div>



    <!-- Liste -->
    <div class="table-responsive">
        <table class="table table-bordered table-striped table-hover align-middle">
            <thead class="table-dark">
                <tr>
                    <th>SeansId</th>
                    <th>Hasta</th>
                    <th>Tarih / Saat</th>
                    <th>Cihaz</th>
                    <th>Personel</th>
                    <th>Durum</th>
                    <th>Notlar</th>
                    <th>Hastanın Telefonu</th>
                    <th colspan="3" class="text-center">İşlemler</th>

                </tr>
            </thead>
            <tbody>
                @if (Model != null && Model.Any())
                {
                    foreach (var seans in Model)
                    {
                        <tr>
                            <td>@seans.SeansId</td>

                            <!-- Hasta adı (navigation property varsa) -->
                            <td>
                                @if (seans.Hasta != null)
                                {
                                    @($"{seans.Hasta.Ad} {seans.Hasta.Soyad}")
                                }
                                else
                                {
                                    @($"ID: {seans.HastaId}")
                                }
                            </td>

                            <td>@seans.TarihSaat.ToString("dd.MM.yyyy HH:mm")</td>

                            <!-- Cihaz -->
                            <td>
                                @if (seans.Cihaz != null)
                                {
                                    @seans.Cihaz.MarkaModel
                                }
                                else
                                {
                                    @(seans.CihazId.HasValue ? $"ID: {seans.CihazId}" : "-")
                                }
                            </td>

                            <!-- Personel -->
                            <td>
                                @if (seans.Personel != null)
                                {
                                    @($"{seans.Personel.Ad} {seans.Personel.Soyad}")
                                }
                                else
                                {
                                    @(seans.PersonelId.HasValue ? $"ID: {seans.PersonelId}" : "-")
                                }
                            </td>

                            <td>@(string.IsNullOrWhiteSpace(seans.Durum) ? "-" : seans.Durum)</td>
                            <td class="text-truncate" style="max-width: 220px;">
                                @(string.IsNullOrWhiteSpace(seans.Notlar) ? "-" : seans.Notlar)
                            </td>

                            <td>
                                @if (seans.Hasta != null)
                                {
                                    <a href="tel:@($"{seans.Hasta.Telefon}")">
                                        @($"{seans.Hasta.Telefon}")
                                    </a>
                                  
                                }
                                else
                                {
                                    @($"ID: {seans.HastaId}")
                                }
                            </td>

                            
                            
                            <td class="text-center">
                                <a href="/Seans/Sil?seansid=@seans.SeansId" class="btn btn-danger btn-sm"
                                   onclick="return confirm('Bu seansı silmek istediğinize emin misiniz?');">Sil</a>
                            </td>
                        </tr>
                    }
                }
                else
                {
                    <tr>
                        <td colspan="10" class="text-center">Kayıt bulunamadı.</td>
                    </tr>
                }
            </tbody>
        </table>
    </div>

    <!-- Sayfalama -->
    <nav aria-label="Sayfalama">
        <ul class="pagination">
            @for (int i = 1; i <= (ViewBag.SayfaSayısı ?? 1); i++)
            {
                bool aktif = (ViewBag.AktifSayfa ?? 1) == i;
                <li class="page-item @(aktif ? "active" : "")">
                    <a class="page-link" href="/Seans/Listeleme?SayfaSayısı=@i">@i</a>
                </li>
            }
        </ul>
    </nav>

</div>
