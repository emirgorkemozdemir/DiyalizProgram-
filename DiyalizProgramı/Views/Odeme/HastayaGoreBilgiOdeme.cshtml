@using EntityLayer
@model List<Odeme>

@{
    Layout = null;
}

<head>
    <link rel="stylesheet" href="/lib/bootstrap/dist/css/bootstrap.css" />
</head>

<div class="container mt-4">

    <!-- Başlık ve Ekleme -->
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h2>Ödeme Listesi</h2>
        <a href="/Odeme/Ekle" class="btn btn-primary">Yeni Ödeme Ekle</a>
    </div>

    <!-- Filtreleme Alanı -->
    

    <!-- Liste -->
    <div class="table-responsive">
        <table class="table table-bordered table-striped table-hover align-middle">
            <thead class="table-dark">
                <tr>
                    <th>Ödeme ID</th>
                    <th>Hasta</th>
                    <th>Tarih</th>
                    <th>Tutar (₺)</th>
                    <th>Ödeme Türü</th>
                    <th>Açıklama</th>
                    <th>Seans Bilgisi</th>
                    <th colspan="3" class="text-center">İşlemler</th>
                </tr>
            </thead>
            <tbody>
                @if (Model != null && Model.Any())
                {
                    foreach (var odeme in Model)
                    {
                        <tr>
                            <td>@odeme.OdemeId</td>

                            <td>
                                @($"{odeme.Hasta.Ad} {odeme.Hasta.Soyad}")
                            </td>

                            <td>@(odeme.OdemeTarihi?.ToString("dd.MM.yyyy") ?? "-")</td>
                            <td>@(odeme.Tutar?.ToString("N2") ?? "-")</td>
                            <td>@(string.IsNullOrWhiteSpace(odeme.OdemeTuru) ? "-" : odeme.OdemeTuru)</td>
                            <td class="text-truncate" style="max-width: 200px;">
                                @(string.IsNullOrWhiteSpace(odeme.Aciklama) ? "-" : odeme.Aciklama)
                            </td>

                            <td>
                                @if (odeme.Seans != null)
                                {
                                    @($"#{odeme.Seans.SeansId} - {odeme.Seans.TarihSaat.ToString("dd.MM.yyyy HH:mm")}")
                                }
                                else if (odeme.SeansId.HasValue)
                                {
                                    @($"ID: {odeme.SeansId}")
                                }
                                else
                                {
                                    @("-")
                                }
                            </td>

                           
                            
                            <td class="text-center">
                                <a href="/Odeme/Sil?odemeid=@odeme.OdemeId" class="btn btn-danger btn-sm"
                                   onclick="return confirm('Bu ödemeyi silmek istediğinize emin misiniz?');">Sil</a>
                            </td>
                        </tr>
                    }
                }
                else
                {
                    <tr>
                        <td colspan="10" class="text-center">Kayıt bulunamadı.</td>
                    </tr>
                }
            </tbody>
        </table>
    </div>

    <!-- Sayfalama -->
    <nav aria-label="Sayfalama">
        <ul class="pagination">
            @for (int i = 1; i <= (ViewBag.SayfaSayısı ?? 1); i++)
            {
                bool aktif = (ViewBag.AktifSayfa ?? 1) == i;
                <li class="page-item @(aktif ? "active" : "")">
                    <a class="page-link" href="/Odeme/Listeleme?SayfaSayısı=@i">@i</a>
                </li>
            }
        </ul>
    </nav>

</div>

